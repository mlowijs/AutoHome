let Binder = require("../../src/Binder");
let childProcess = require("child_process");

class BluetoothBinder extends Binder {
    constructor(logger) {
        super(logger);
    }

    getType() {
        return "bt";
    }

    scan(thing, binding) {
        clearInterval(binding._interval);

        this.logger.debug(`Executing l2ping to get presence for '${thing.id}'`, "BluetoothBinder.receive");

        childProcess.exec(`l2ping -c 1 ${binding.mac}`, { "stdio": "ignore" }, (error) => {
            thing = error === null;

            let interval = thing.value ? binding.intervalPresent : binding.intervalAbsent;
            binding._interval = setInterval(() => this.scan(thing, binding), interval * 1000);
        });
    }

    bind(thing, binding) {
        binding._interval = setInterval(() => this.scan(thing, binding), binding.intervalAbsent * 1000);
    }
}

module.exports = BluetoothBinder;